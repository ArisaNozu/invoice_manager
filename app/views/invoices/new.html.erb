
<div class="page-title">請求書新規装録</div>

  <%= form_with model: @invoice, local: true, data: { turbo: false } do |f| %>
  <%= render 'shared/error_messages', model: @invoice  %>

<div class="page-subtitle">案件名 </div>
  <%= f.text_field :subject,class: "invoice-subject",id: "invoice-subject",placeholder: "案件名 （100文字まで)",maxlength: 100 %>

<div class="page-subtitle">請求書ファイル（PDF/画像）</div>
  <div class="click-upload">
    <%= f.file_field :file, id:"invoice-file" %>
  </div>

<div class="page-subtitle">処理ステータス（必須）</div>
  <div class="status">
        <%= f.collection_select(:status, Status.all, :id, :name, {}, {class:"select-box", id:"item-prefecture"}) %>
  </div>

<div class="page-subtitle">受領形態（必須）</div>
  <div class="receipt_method">
        <%= f.collection_select(:receipt_method, ReceiptMethod.all, :id, :name, {}, {class:"select-box", id:"item-prefecture"}) %>
  </div>
<div>

<div data-controller="invoice">

 <div class="page-subtitle">取引先番号（11桁の数字）（必須）</div>
  <%= f.number_field :client_code,
        data: {
          action: "blur->invoice#fetchClientInfo input->invoice#clearClientIfEmpty",
          invoice_target: "clientCode"
        } %>
  
  <!-- 表示欄 -->
  <div class="page-subtitle">取引先名</div>
  <div data-invoice-target="clientName">------</div>
  <div>適格請求書発行事業者番号（T + 13桁の数字）</div>
  <div data-invoice-target="invoiceRegNo">--------------</div>
  <div>適格請求書発行事業者かどうか</div>
  <div data-invoice-target="qualifiedFlag">------</div>

</div>




</div>

<div class="page-subtitle">請求書受領頻度（必須）</div>
  <div class="receipt_frequency">
        <%= f.collection_select(:receipt_frequency, ReceiptFrequency.all, :id, :name, {}, {class:"select-box", id:"item-prefecture"}) %>

<div class="page-subtitle">取引日（必須）</div>
  <%= f.date_field :transaction_date, required: true %>

<div class="page-subtitle">支払期日（必須）</div>
  <%= f.date_field :due_date, required: true %>

<div class="page-subtitle">受領日（必須）</div>
  <%= f.date_field :received_date, required: true %>

<div data-controller="invoice">
  <!-- 税率 -->
  <div class="page-subtitle">消費税率</div>
  <%= f.collection_select(
        :tax_rate,
        TaxRate.all, :id, :name, {},
        { class: "select-box",
          data: { action: "change->invoice#recalcTax", invoice_target: "taxRate" } }
      ) %>

  <!-- 本体金額 -->
  <div class="page-subtitle">本体金額（円）（必須）</div>
  <%= f.text_field :net_amount,
      data: { action: "input->invoice#formatNetAmount", invoice_target: "netAmount" } %>

  <!-- 端数処理 -->
  <div>
    <label>端数処理（必須）</label>
    <select data-action="change->invoice#recalcTax" data-invoice-target="roundingMode">
      <option value="floor">切り捨て</option>
      <option value="round">四捨五入</option>
      <option value="ceil">切り上げ</option>
    </select>
  </div>

  <!-- 調整額（+/-） -->
  <div>
    <label>※税額調整（円）</label>
    <input type="number" value="0"
           data-action="input->invoice#recalcTax"
           data-invoice-target="taxAdjust">
  </div>

  <!-- 手動上書き　実装する場合は有効化 -->
  <%# <div>
    <label>
      <input type="checkbox"
             data-action="change->invoice#toggleOverride change->invoice#recalcTax"
             data-invoice-target="overrideToggle">
      税額を手動で上書きする
    </label>
  </div> %>

<!-- 消費税額（自動 or 手動） -->
<div>消費税額</div>
<%= f.text_field :tax_amount,
      data: { invoice_target: "taxAmount" },
      readonly: true %>

<!-- 合計額（自動計算・手動変更不可） -->
<div>合計額</div>
<%= f.text_field :total_amount,
      data: { invoice_target: "totalAmount" },
      readonly: true %>


<div class="page-subtitle">メモ欄 </div>
  <%= f.text_area :memo, class:"invoice-memo", id:"invoice-memo", placeholder:"メモ欄 （500文字まで)", maxlength:"500" %>

<div><%= f.submit "保存" %> </div>
<% end %>

